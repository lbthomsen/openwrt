From 21d106f15262f5a2ef7531636e0703ee61c33c61 Mon Sep 17 00:00:00 2001
From: Sungbo Eo <mans0n@gorani.run>
Date: Sun, 8 Aug 2021 21:38:40 +0900
Subject: [PATCH 2/2] arm: dts: mt7623: add musb device nodes

MT7623 has an musb controller that is compatible with the one from MT2701.

Signed-off-by: Sungbo Eo <mans0n@gorani.run>
---
 arch/arm/boot/dts/mt7623.dtsi  | 34 ++++++++++++++++++++++++++++++++++
 arch/arm/boot/dts/mt7623a.dtsi |  4 ++++
 2 files changed, 38 insertions(+)

Index: linux-5.15.34/arch/arm/boot/dts/mt7623.dtsi
===================================================================
--- linux-5.15.34.orig/arch/arm/boot/dts/mt7623.dtsi
+++ linux-5.15.34/arch/arm/boot/dts/mt7623.dtsi
@@ -585,6 +585,52 @@
 		status = "disabled";
 	};
 
+	usb0: usb@11200000 {
+		compatible = "mediatek,mt7623-musb",
+			     "mediatek,mtk-musb";
+		reg = <0 0x11200000 0 0x1000>;
+		interrupts = <GIC_SPI 32 IRQ_TYPE_LEVEL_LOW>;
+		interrupt-names = "mc";
+		phys = <&u2port2 PHY_TYPE_USB2>;
+		dr_mode = "otg";
+		clocks = <&pericfg CLK_PERI_USB0>,
+			 <&pericfg CLK_PERI_USB0_MCU>,
+			 <&pericfg CLK_PERI_USB_SLV>;
+		clock-names = "main","mcu","univpll";
+		power-domains = <&scpsys MT2701_POWER_DOMAIN_IFR_MSC>;
+		status = "okay";
+                pinctrl-names = "default";
+                pinctrl-0 = <0x22>;
+                usb-role-switch;
+                phandle = <0x8e>;
+
+                connector {
+                        compatible = "gpio-usb-b-connector\0usb-b-connector";
+                        type = "micro";
+                        id-gpios = <0x13 0x2c 0x00>;
+                };
+
+	};
+
+	u2phy1: t-phy@11210000 {
+		compatible = "mediatek,mt7623-tphy",
+			     "mediatek,generic-tphy-v1";
+		reg = <0 0x11210000 0 0x0800>;
+		#address-cells = <2>;
+		#size-cells = <2>;
+		ranges;
+		status = "okay";
+		phandle = <0x8f>;
+
+		u2port2: usb-phy@11210800 {
+			reg = <0 0x11210800 0 0x0100>;
+			clocks = <&topckgen CLK_TOP_USB_PHY48M>;
+			clock-names = "ref";
+			#phy-cells = <1>;
+			status = "okay";
+		};
+	};
+
 	audsys: clock-controller@11220000 {
 		compatible = "mediatek,mt7623-audsys",
 			     "mediatek,mt2701-audsys",
@@ -710,6 +756,26 @@
 		#clock-cells = <1>;
 	};
 
+	consys: consys@18070000 {
+		compatible = "mediatek,mt7623-consys";
+		reg = <0x00 0x18070000 0x00 0x200 0x00 0x10001000 0x00 0x1600>;
+		clocks = <0x02 0x09>;
+		clock-names = "consysbus";
+		power-domains = <0x1f 0x00>;
+		interrupts = <0x00 0xb9 0x08 0x00 0xa3 0x08>;
+		resets = <0x2a 0x0c>;
+		reset-names = "connsys";
+		status = "okay";
+		mediatek,pwrap-regmap = <0x2b>;
+		pinctrl-names = "default";
+		pinctrl-0 = <0x2c>;
+		vcn18-supply = <0x2d>;
+		vcn28-supply = <0x2e>;
+		vcn33_bt-supply = <0x2f>;
+		vcn33_wifi-supply = <0x30>;
+		phandle = <0x93>;
+	};
+
 	hifsys: syscon@1a000000 {
 		compatible = "mediatek,mt7623-hifsys",
 			     "mediatek,mt2701-hifsys",
@@ -1263,4 +1329,22 @@
 				 <MT7623_PIN_201_UTXD2_FUNC_UTXD2>;
 		};
 	};
+
+	musb_pins_a: musb {
+		phandle = <0x22>;
+
+		pins-musb {
+			pinmux = <0xed02>;
+		};
+	};
+
+	consys_pins_a: consys_pins_default {
+		phandle = <0x2c>;
+
+		adie {
+			pinmux = <0x3c01 0x3d01 0x3e01 0x3f01 0x4001 0x4101 0x4201 0x4301 0x4401 0x4501 0x4601 0x4701>;
+			bias-disable;
+		};
+	};
+
 };
Index: linux-5.15.34/arch/arm/boot/dts/mt7623a.dtsi
===================================================================
--- linux-5.15.34.orig/arch/arm/boot/dts/mt7623a.dtsi
+++ linux-5.15.34/arch/arm/boot/dts/mt7623a.dtsi
@@ -35,6 +35,10 @@
 	clock-names = "ethif";
 };
 
+&usb0 {
+	power-domains = <&scpsys MT7623A_POWER_DOMAIN_IFR_MSC>;
+};
+
 &usb1 {
 	power-domains = <&scpsys MT7623A_POWER_DOMAIN_HIF>;
 };
Index: linux-5.15.34/arch/arm/boot/dts/mt7623n-bananapi-bpi-r2.dts
===================================================================
--- linux-5.15.34.orig/arch/arm/boot/dts/mt7623n-bananapi-bpi-r2.dts
+++ linux-5.15.34/arch/arm/boot/dts/mt7623n-bananapi-bpi-r2.dts
@@ -140,6 +140,7 @@
 		device_type = "memory";
 		reg = <0 0x80000000 0 0x80000000>;
 	};
+
 };
 
 &bls {
